{"version":3,"sources":["webpack:///webpack/bootstrap c8b5a4f0f039b8f70ae3","webpack:///./boot/electron.ts","webpack:///external \"electron\"","webpack:///./modules/FileStorage/helper/FileStorageMain.ts","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./~/sanitize-filename/index.js","webpack:///./~/truncate-utf8-bytes/index.js","webpack:///./~/truncate-utf8-bytes/lib/truncate.js"],"names":[],"mappings":"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AAG,CAAG,GAAG,CAAE;yBACrB,CAAC;qBACH,CAAC,CAAC;iBACJ,CAAC;aACH,CAAC;SACH,CAAC;SACD,OAAO,GAAG,GAAG;KACf,CAAC,CAAC;KAEF,OAAO,CAAC,EAAE,CAAG,eAAe,EAAE,CAAE,KAAK,EAAE,GAAG;KAE1C,CAAC,CAAC;KAEF,OAAO,CAAC,EAAE,CAAG,gBAAgB,EAAE,CAAE,KAAK,EAAE,SAAS;SAC/C,4BAA4B;KAC9B,CAAC,CAAC;KAEF;;;;OAIE;AACJ,EAAC;;;;;;;AClED,gC;;;;;;ACAA,kC;;;;;;ACAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,OAAO;AACnB,aAAY,OAAO,UAAU;AAC7B,aAAY,OAAO;AACnB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvDA;;AAEA;AACA;AACA;;;;;;;ACJA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,kBAAiB,gBAAgB;AACjC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"electron.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c8b5a4f0f039b8f70ae3\n **/","declare var require: any\ndeclare var process: any\ndeclare var __dirname: any\n\nconst { app, BrowserWindow } = require ( 'electron' )\nimport { start as startFileStorageSync } from '../modules/FileStorage/helper/FileStorageMain'\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\nlet win\n\nfunction createWindow() {\n  // Create the browser window.\n  win = new BrowserWindow({width: 800, height: 600})\n\n  // Here __dirname will be app/build/electron.js\n  win.loadURL(`file://${__dirname}/../electron.dev.html`)\n\n  // Open the DevTools.\n  win.webContents.openDevTools()\n\n  // Emitted when the window is closed.\n  win.on('closed', () => {\n    // Dereference the window object, usually you would store windows\n    // in an array if your app supports multi windows, this is the time\n    // when you should delete the corresponding element.\n    win = null\n  })\n\n  startFileStorageSync ()\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on( 'ready', createWindow )\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n  // On macOS it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', () => {\n  // On macOS it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (win === null) {\n    createWindow()\n  }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./boot/electron.ts\n **/","module.exports = require(\"electron\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"electron\"\n ** module id = 1\n ** module chunks = 0\n **/","// FileStorageHelper runs on the window process.\n// This helper runs on the main process.\n\ndeclare var require: any\nconst { ipcMain, dialog } = require ( 'electron' )\nconst fs = require ( 'fs' )\nconst path = require ( 'path' )\nconst sanitize = require ( 'sanitize-filename' )\n\nconst FILE_STATUS = {}\n\n// Latest project and scene saved to fs\nlet project\nlet scene\n\n// User selected project and library paths\n// FIXME !!! \"open project\" and \"select library\" (where is default lib path ?)\nlet projectPath = '/Users/gaspard/git/lucidity.project'\nlet libraryPath = '/Users/gaspard/git/lucidity.library/components'\n\nexport const start = () => {\n  console.log ( 'start FileStorageMain' )\n\n  ipcMain.on ( 'open-project', () => {\n    // TODO\n  })\n\n  ipcMain.on ( 'project-changed', ( event, doc ) => {\n    const p = path.resolve ( projectPath, `${ sanitize ( doc.name ) }.lucy` )\n\n    fs.writeFile ( p, JSON.stringify ( doc, null, 2 ), 'utf8', ( err ) => {\n      if ( err ) {\n        console.log ( err )\n      }\n    })\n\n    if ( project ) {\n      if ( project.name !== doc.name ) {\n        // remove old file\n        const p = path.resolve ( projectPath, `${ sanitize ( project.name ) }.lucy` )\n        const f = fs.statSync ( p )\n        if ( f && f.isFile () ) {\n          fs.unlink ( p, ( err ) => {\n            if ( err ) {\n              console.log ( err )\n            }\n          })\n        }\n      }\n    }\n    project = doc\n  })\n\n  ipcMain.on ( 'scene-changed', ( event, doc ) => {\n\n  })\n\n  ipcMain.on ( 'save-component', ( event, component ) => {\n    // Save component to library\n  })\n\n  /* TODO: optimize with:\n  ipcMain.on ( 'source-changed', ( event, { blockId, source } ) => {\n\n  })\n  */\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/FileStorage/helper/FileStorageMain.ts\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 4\n ** module chunks = 0\n **/","/*jshint node:true*/\n'use strict';\n\n/**\n * Replaces characters in strings that are illegal/unsafe for filenames.\n * Unsafe characters are either removed or replaced by a substitute set\n * in the optional `options` object.\n *\n * Illegal Characters on Various Operating Systems\n * / ? < > \\ : * | \"\n * https://kb.acronis.com/content/39790\n *\n * Unicode Control codes\n * C0 0x00-0x1f & C1 (0x80-0x9f)\n * http://en.wikipedia.org/wiki/C0_and_C1_control_codes\n *\n * Reserved filenames on Unix-based systems (\".\", \"..\")\n * Reserved filenames in Windows (\"CON\", \"PRN\", \"AUX\", \"NUL\", \"COM1\",\n * \"COM2\", \"COM3\", \"COM4\", \"COM5\", \"COM6\", \"COM7\", \"COM8\", \"COM9\",\n * \"LPT1\", \"LPT2\", \"LPT3\", \"LPT4\", \"LPT5\", \"LPT6\", \"LPT7\", \"LPT8\", and\n * \"LPT9\") case-insesitively and with or without filename extensions.\n *\n * Capped at 255 characters in length.\n * http://unix.stackexchange.com/questions/32795/what-is-the-maximum-allowed-filename-and-folder-size-with-ecryptfs\n *\n * @param  {String} input   Original filename\n * @param  {Object} options {replacement: String}\n * @return {String}         Sanitized filename\n */\n\nvar truncate = require(\"truncate-utf8-bytes\");\n\nvar illegalRe = /[\\/\\?<>\\\\:\\*\\|\":]/g;\nvar controlRe = /[\\x00-\\x1f\\x80-\\x9f]/g;\nvar reservedRe = /^\\.+$/;\nvar windowsReservedRe = /^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\\..*)?$/i;\nvar windowsTrailingRe = /[\\. ]+$/;\n\nfunction sanitize(input, replacement) {\n  var sanitized = input\n    .replace(illegalRe, replacement)\n    .replace(controlRe, replacement)\n    .replace(reservedRe, replacement)\n    .replace(windowsReservedRe, replacement)\n    .replace(windowsTrailingRe, replacement);\n  return truncate(sanitized, 255);\n}\n\nmodule.exports = function (input, options) {\n  var replacement = (options && options.replacement) || '';\n  var output = sanitize(input, replacement);\n  if (replacement === '') {\n    return output;\n  }\n  return sanitize(output, '');\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/sanitize-filename/index.js\n ** module id = 5\n ** module chunks = 0\n **/","'use strict';\n\nvar truncate = require(\"./lib/truncate\");\nvar getLength = Buffer.byteLength.bind(Buffer);\nmodule.exports = truncate.bind(null, getLength);\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/truncate-utf8-bytes/index.js\n ** module id = 6\n ** module chunks = 0\n **/","'use strict';\n\nfunction isHighSurrogate(codePoint) {\n  return codePoint >= 0xd800 && codePoint <= 0xdbff;\n}\n\nfunction isLowSurrogate(codePoint) {\n  return codePoint >= 0xdc00 && codePoint <= 0xdfff;\n}\n\n// Truncate string by size in bytes\nmodule.exports = function truncate(getLength, string, byteLength) {\n  if (typeof string !== \"string\") {\n    throw new Error(\"Input must be string\");\n  }\n\n  var charLength = string.length;\n  var curByteLength = 0;\n  var codePoint;\n  var segment;\n\n  for (var i = 0; i < charLength; i += 1) {\n    codePoint = string.charCodeAt(i);\n    segment = string[i];\n\n    if (isHighSurrogate(codePoint) && isLowSurrogate(string.charCodeAt(i + 1))) {\n      i += 1;\n      segment += string[i];\n    }\n\n    curByteLength += getLength(segment);\n\n    if (curByteLength === byteLength) {\n      return string.slice(0, i + 1);\n    }\n    else if (curByteLength > byteLength) {\n      return string.slice(0, i - segment.length + 1);\n    }\n  }\n\n  return string;\n};\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/truncate-utf8-bytes/lib/truncate.js\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":""}